<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Quiz Question Management</title>
<style>
:root {
  --bg: #f0f4f8;
  --card: #ffffff;
  --text: #1a202c;
  --muted: #718096;
  --primary: #4299e1;
  --primary-dark: #2b6cb0;
  --success: #48bb78;
  --danger: #f56565;
  --warning: #ed8936;
  --border: #e2e8f0;
  --hover: #edf2f7;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  padding: 20px;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
}

.header {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  padding: 30px;
  border-radius: 12px;
  margin-bottom: 30px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.header h1 {
  font-size: 32px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.header p {
  opacity: 0.9;
  font-size: 16px;
}

.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: var(--card);
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  border-left: 4px solid var(--primary);
}

.stat-card h3 {
  color: var(--muted);
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}

.stat-card .value {
  font-size: 32px;
  font-weight: 700;
  color: var(--primary);
}

.controls {
  background: var(--card);
  padding: 25px;
  border-radius: 12px;
  margin-bottom: 25px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.controls h2 {
  margin-bottom: 20px;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 10px;
}

.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  margin-bottom: 15px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-group label {
  font-weight: 600;
  font-size: 14px;
  color: var(--text);
}

.form-group input,
.form-group select,
.form-group textarea {
  padding: 12px;
  border: 2px solid var(--border);
  border-radius: 6px;
  font-size: 14px;
  font-family: inherit;
  transition: all 0.2s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.form-group textarea {
  resize: vertical;
  min-height: 80px;
  font-family: inherit;
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(66, 153, 225, 0.3);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-success:hover {
  background: #38a169;
  transform: translateY(-1px);
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-danger:hover {
  background: #e53e3e;
}

.btn-small {
  padding: 6px 12px;
  font-size: 12px;
}

.questions-grid {
  display: grid;
  gap: 20px;
}

.question-card {
  background: var(--card);
  border-radius: 12px;
  padding: 25px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  transition: all 0.3s;
  border-left: 4px solid var(--primary);
}

.question-card:hover {
  box-shadow: 0 8px 16px rgba(0,0,0,0.12);
  transform: translateY(-2px);
}

.question-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 15px;
  gap: 15px;
}

.question-id {
  background: var(--primary);
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 14px;
}

.module-badge {
  background: var(--success);
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
}

.question-actions {
  display: flex;
  gap: 8px;
}

.question-text {
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 15px;
  color: var(--text);
  line-height: 1.6;
}

.choices {
  display: grid;
  gap: 10px;
  margin-bottom: 15px;
}

.choice {
  display: flex;
  align-items: start;
  gap: 12px;
  padding: 12px;
  background: var(--hover);
  border-radius: 6px;
  border: 2px solid transparent;
  transition: all 0.2s;
}

.choice.correct {
  background: rgba(72, 187, 120, 0.1);
  border-color: var(--success);
}

.choice-letter {
  background: var(--primary);
  color: white;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 14px;
  flex-shrink: 0;
}

.choice.correct .choice-letter {
  background: var(--success);
}

.choice-text {
  flex: 1;
  padding-top: 2px;
}

.explanation {
  background: rgba(66, 153, 225, 0.05);
  border-left: 4px solid var(--primary);
  padding: 15px;
  border-radius: 6px;
  margin-top: 15px;
  font-size: 14px;
  color: var(--text);
}

.explanation strong {
  color: var(--primary);
  display: block;
  margin-bottom: 6px;
}

.edit-form {
  display: none;
  padding: 20px;
  background: var(--hover);
  border-radius: 8px;
  margin-top: 15px;
}

.edit-form.active {
  display: block;
}

.filter-bar {
  display: flex;
  gap: 15px;
  margin-bottom: 25px;
  flex-wrap: wrap;
  align-items: center;
}

.filter-bar select {
  padding: 10px 15px;
  border: 2px solid var(--border);
  border-radius: 6px;
  font-size: 14px;
  background: white;
}

.search-box {
  flex: 1;
  min-width: 250px;
}

.search-box input {
  width: 100%;
  padding: 10px 15px;
  border: 2px solid var(--border);
  border-radius: 6px;
  font-size: 14px;
}

.icon {
  font-size: 20px;
}

.alert {
  padding: 15px 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  display: none;
}

.alert.show {
  display: block;
}

.alert-success {
  background: rgba(72, 187, 120, 0.1);
  border-left: 4px solid var(--success);
  color: var(--success);
}

.alert-error {
  background: rgba(245, 101, 101, 0.1);
  border-left: 4px solid var(--danger);
  color: var(--danger);
}

@media (max-width: 768px) {
  .question-header {
    flex-direction: column;
  }
  
  .form-row {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>
        <span class="icon">üìù</span>
        Quiz Question Management
      </h1>
      <p>Manage quiz questions, edit module assignments, and add new questions</p>
    </div>

    <div id="alert" class="alert"></div>

    <div class="stats">
      <div class="stat-card">
        <h3>Total Questions</h3>
        <div class="value" id="total-questions">{{ questions|length }}</div>
      </div>
      <div class="stat-card">
        <h3>Modules</h3>
        <div class="value" id="total-modules">{{ modules|length }}</div>
      </div>
      <div class="stat-card">
        <h3>Chapters</h3>
        <div class="value">{{ chapters|length }}</div>
      </div>
    </div>

    <div class="controls">
      <h2>
        <span class="icon">‚ûï</span>
        Add New Question
      </h2>
      <form id="add-question-form" method="POST" action="{{ url_for('add_quiz_question') }}">
        <div class="form-row">
          <div class="form-group">
            <label for="question_id">Question ID *</label>
            <input type="text" id="question_id" name="question_id" placeholder="e.g., q1_1_1" required>
          </div>
          <div class="form-group">
            <label for="module_id">Module *</label>
            <select id="module_id" name="module_id" required>
              <option value="">Select Module...</option>
              {% for module in modules %}
              <option value="{{ module.id }}">{{ module.id }} - {{ module.title }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="display_order">Display Order *</label>
            <input type="number" id="display_order" name="display_order" value="1" min="1" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="question">Question Text *</label>
          <textarea id="question" name="question" placeholder="Enter your question here..." required></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="choice_a">Choice A *</label>
            <input type="text" id="choice_a" name="choice_a" placeholder="First answer choice" required>
          </div>
          <div class="form-group">
            <label for="choice_b">Choice B *</label>
            <input type="text" id="choice_b" name="choice_b" placeholder="Second answer choice" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="choice_c">Choice C *</label>
            <input type="text" id="choice_c" name="choice_c" placeholder="Third answer choice" required>
          </div>
          <div class="form-group">
            <label for="choice_d">Choice D *</label>
            <input type="text" id="choice_d" name="choice_d" placeholder="Fourth answer choice" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="correct_choice">Correct Answer *</label>
            <select id="correct_choice" name="correct_choice" required>
              <option value="">Select correct answer...</option>
              <option value="a">A</option>
              <option value="b">B</option>
              <option value="c">C</option>
              <option value="d">D</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="explanation">Explanation *</label>
          <textarea id="explanation" name="explanation" placeholder="Explain why this answer is correct..." required></textarea>
        </div>
        
        <button type="submit" class="btn btn-success">
          <span>‚úì</span> Add Question
        </button>
      </form>
    </div>

    <div class="filter-bar">
      <select id="filter-module" onchange="filterQuestions()">
        <option value="">All Modules</option>
        {% for module in modules %}
        <option value="{{ module.id }}">{{ module.id }} - {{ module.title }}</option>
        {% endfor %}
      </select>
      
      <select id="filter-chapter" onchange="filterQuestions()">
        <option value="">All Chapters</option>
        {% for chapter in chapters %}
        <option value="{{ chapter.id }}">Chapter {{ chapter.id }}: {{ chapter.title }}</option>
        {% endfor %}
      </select>
      
      <div class="search-box">
        <input type="text" id="search" placeholder="üîç Search questions..." onkeyup="filterQuestions()">
      </div>
    </div>

    <div class="questions-grid" id="questions-grid">
      {% for question in questions %}
      <div class="question-card" data-module="{{ question.module_id }}" data-chapter="{{ question.module.chapter_id }}">
        <div class="question-header">
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <span class="question-id">{{ question.id }}</span>
            <span class="module-badge">Module {{ question.module_id }}</span>
          </div>
          <div class="question-actions">
            <button class="btn btn-primary btn-small" onclick="toggleEdit('{{ question.id }}')">
              ‚úèÔ∏è Edit
            </button>
            <button class="btn btn-danger btn-small" onclick="deleteQuestion('{{ question.id }}')">
              üóëÔ∏è Delete
            </button>
          </div>
        </div>
        
        <div class="question-text">{{ question.question }}</div>
        
        <div class="choices">
          <div class="choice {% if question.correct_choice == 'a' %}correct{% endif %}">
            <div class="choice-letter">A</div>
            <div class="choice-text">{{ question.choice_a }}</div>
          </div>
          <div class="choice {% if question.correct_choice == 'b' %}correct{% endif %}">
            <div class="choice-letter">B</div>
            <div class="choice-text">{{ question.choice_b }}</div>
          </div>
          <div class="choice {% if question.correct_choice == 'c' %}correct{% endif %}">
            <div class="choice-letter">C</div>
            <div class="choice-text">{{ question.choice_c }}</div>
          </div>
          <div class="choice {% if question.correct_choice == 'd' %}correct{% endif %}">
            <div class="choice-letter">D</div>
            <div class="choice-text">{{ question.choice_d }}</div>
          </div>
        </div>
        
        {% if question.explanation %}
        <div class="explanation">
          <strong>üí° Explanation:</strong>
          {{ question.explanation }}
        </div>
        {% endif %}
        
        <div id="edit-{{ question.id }}" class="edit-form">
          <form method="POST" action="{{ url_for('update_quiz_question', question_id=question.id) }}">
            <div class="form-row">
              <div class="form-group">
                <label>Move to Module</label>
                <select name="module_id" required>
                  {% for module in modules %}
                  <option value="{{ module.id }}" {% if module.id == question.module_id %}selected{% endif %}>
                    {{ module.id }} - {{ module.title }}
                  </option>
                  {% endfor %}
                </select>
              </div>
              <div class="form-group">
                <label>Display Order</label>
                <input type="number" name="display_order" value="{{ question.display_order }}" min="1" required>
              </div>
            </div>
            
            <div class="form-group">
              <label>Question Text</label>
              <textarea name="question" required>{{ question.question }}</textarea>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Choice A</label>
                <input type="text" name="choice_a" value="{{ question.choice_a }}" required>
              </div>
              <div class="form-group">
                <label>Choice B</label>
                <input type="text" name="choice_b" value="{{ question.choice_b }}" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Choice C</label>
                <input type="text" name="choice_c" value="{{ question.choice_c }}" required>
              </div>
              <div class="form-group">
                <label>Choice D</label>
                <input type="text" name="choice_d" value="{{ question.choice_d }}" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Correct Answer</label>
                <select name="correct_choice" required>
                  <option value="a" {% if question.correct_choice == 'a' %}selected{% endif %}>A</option>
                  <option value="b" {% if question.correct_choice == 'b' %}selected{% endif %}>B</option>
                  <option value="c" {% if question.correct_choice == 'c' %}selected{% endif %}>C</option>
                  <option value="d" {% if question.correct_choice == 'd' %}selected{% endif %}>D</option>
                </select>
              </div>
            </div>
            
            <div class="form-group">
              <label>Explanation</label>
              <textarea name="explanation" required>{{ question.explanation }}</textarea>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
              <button type="submit" class="btn btn-success btn-small">
                <span>‚úì</span> Save Changes
              </button>
              <button type="button" class="btn btn-danger btn-small" onclick="toggleEdit('{{ question.id }}')">
                <span>‚úï</span> Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <script>
    function toggleEdit(questionId) {
      const form = document.getElementById('edit-' + questionId);
      form.classList.toggle('active');
    }

    function deleteQuestion(questionId) {
      if (!confirm('Are you sure you want to delete question ' + questionId + '?')) {
        return;
      }
      
      fetch('/delete_quiz_question/' + questionId, {
        method: 'POST',
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showAlert('Question deleted successfully!', 'success');
          setTimeout(() => location.reload(), 1000);
        } else {
          showAlert('Error deleting question: ' + data.error, 'error');
        }
      })
      .catch(error => {
        showAlert('Error deleting question', 'error');
      });
    }

    function filterQuestions() {
      const moduleFilter = document.getElementById('filter-module').value.toLowerCase();
      const chapterFilter = document.getElementById('filter-chapter').value;
      const searchText = document.getElementById('search').value.toLowerCase();
      
      const cards = document.querySelectorAll('.question-card');
      let visibleCount = 0;
      
      cards.forEach(card => {
        const module = card.getAttribute('data-module').toLowerCase();
        const chapter = card.getAttribute('data-chapter');
        const text = card.textContent.toLowerCase();
        
        const moduleMatch = !moduleFilter || module === moduleFilter;
        const chapterMatch = !chapterFilter || chapter === chapterFilter;
        const searchMatch = !searchText || text.includes(searchText);
        
        if (moduleMatch && chapterMatch && searchMatch) {
          card.style.display = 'block';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });
      
      document.getElementById('total-questions').textContent = visibleCount;
    }

    function showAlert(message, type) {
      const alert = document.getElementById('alert');
      alert.textContent = message;
      alert.className = 'alert alert-' + type + ' show';
      
      setTimeout(() => {
        alert.classList.remove('show');
      }, 5000);
    }

    // Show success message if present
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('success')) {
      showAlert(urlParams.get('success'), 'success');
    }
    if (urlParams.get('error')) {
      showAlert(urlParams.get('error'), 'error');
    }
  </script>
</body>
</html>

